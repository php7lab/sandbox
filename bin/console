#!/usr/bin/env php
<?php

use PhpLab\Sandbox\Package\Commands\InfoChangedCommand;
use PhpLab\Sandbox\Package\Domain\Repositories\File\GroupRepository;
use PhpLab\Sandbox\Package\Domain\Repositories\File\InfoRepository;
use PhpLab\Sandbox\Package\Domain\Services\GroupService;
use PhpLab\Sandbox\Package\Domain\Services\InfoService;
use Symfony\Component\Console\Application;
use Symfony\Component\Dotenv\Dotenv;

use PhpLab\Sandbox\Dev\Commands\StressCommand;
use PhpLab\Sandbox\Dev\Domain\Services\StressService;

require __DIR__ . '/../../../autoload.php';

if (!class_exists(Dotenv::class)) {
    throw new RuntimeException('Please run "composer require symfony/dotenv" to load the ".env" files configuring the application.');
} else {
    // load all the .env files
    (new Dotenv(false))->loadEnv(__DIR__ . '/../../../../.env');
}

// создаем консольное приложение
$application = new Application;

// создаем и объявляем команды
$stressService = new StressService;
$command = new StressCommand(StressCommand::getDefaultName(), $stressService);
$application->add($command);

$fileName = __DIR__ . '/../../../../vendor/php7extension/core/src/package/domain/data/package_group.php';
$groupRepository = new GroupRepository($fileName);
$groupService = new GroupService($groupRepository);

$infoRepository = new InfoRepository($groupService);
$infoService = new InfoService($infoRepository);
$command = new InfoChangedCommand(null, $infoService);
$application->add($command);

$application->run();
